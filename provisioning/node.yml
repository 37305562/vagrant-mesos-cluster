---
- hosts: nodes
  remote_user: vagrant
  become: yes
  become_method: sudo
  tasks:
      - name: update hosts file
        template: src=templates/hosts.j2 dest=/etc/hosts

      - name: configure dns
        template: src=templates/resolv.conf.j2 dest=/etc/resolv.conf


      - name: install mesosphere yum repo
        yum: name=http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-1.noarch.rpm state=present

      - name: install mesos and docker packages
        yum: pkg=device-mapper-event-libs,mesos,docker state=latest


      - name: set zookeeper master
        replace: dest=/etc/mesos/zk regexp="localhost" replace="192.168.1.10"

      - name: configure containerizers
        lineinfile: dest=/etc/mesos-slave/containerizers create=yes line="docker,mesos"


      - name: start mesos-master
        service: name=mesos-master state=stopped enabled=no

      - name: start mesos-slave
        service: name=mesos-slave state=started enabled=yes

      - name: start docker
        service: name=docker state=started enabled=yes
